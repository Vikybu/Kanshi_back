name: configCi
on: 
    push:
        branches: [main]
    pull_request:
        branches: [main]

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            
            - name: Setup PHP
              uses: shivammathur/setup-php@v2
              with:
                php-version: '8.2'
                
            - name: Copy .env
              run: cp .env.testing .env
              
            - name: Override DB config for CI
              run: |
                sed -i 's/DB_CONNECTION=mysql/DB_CONNECTION=sqlite/' .env
                sed -i 's/DB_DATABASE=Kanshi_test/DB_DATABASE=:memory:/' .env
                
            - name: Install dependencies
              run: composer install --prefer-dist --no-progress
              
            - name: Generate application key
              run: php artisan key:generate
              
            - name: Run migrations
              run: php artisan migrate --force
              
            - name: Running tests
              run: php artisan test