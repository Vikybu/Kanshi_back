name: configCi
on: 
    push:
        branches: [main]
    pull_request:
        branches: [main]

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            
            - name: Setup PHP
              uses: shivammathur/setup-php@v2
              with:
                php-version: '8.2'
                
            - name: Create .env for testing
              run: |
                cat > .env << EOF
                APP_ENV=testing
                APP_DEBUG=true
                APP_KEY=
                DB_CONNECTION=sqlite
                DB_DATABASE=:memory:
                CACHE_DRIVER=array
                QUEUE_CONNECTION=sync
                SESSION_DRIVER=array
                EOF
                
            - name: Install dependencies
              run: composer install --prefer-dist --no-progress
              
            - name: Generate application key
              run: php artisan key:generate
              
            - name: Run migrations
              run: php artisan migrate --force
              
            - name: Running tests
              run: php artisan test